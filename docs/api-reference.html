<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Reference - MongoDB Agent AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
        }

        .nav {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
        }

        .nav a:hover {
            text-decoration: underline;
        }

        .container {
            max-width: 1000px;
            margin: 40px auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #667eea;
            margin-bottom: 5px;
            font-size: 2.5em;
        }

        h2 {
            color: #667eea;
            margin-top: 5px;
            margin-bottom: 5px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        h3 {
            color: #555;
            margin-top: 5px;
            margin-bottom: 5px;
        }

        p {
            margin-bottom: 5px;
        }

        pre {
            background: #2d3748;
            color: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 5px 0;
        }

        code {
            font-family: 'Courier New', monospace;
        }

        .endpoint {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 5px 0;
            border-left: 4px solid #667eea;
        }

        .method {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 600;
            margin-right: 10px;
            font-size: 0.9em;
        }

        .method.post {
            background: #10b981;
            color: white;
        }

        .method.get {
            background: #3b82f6;
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 5px 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #667eea;
        }

        .info-box {
            background: #e8f4f8;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 5px 0;
            border-radius: 5px;
        }

        .warning-box {
            background: #fff4e6;
            border-left: 4px solid #fb923c;
            padding: 15px;
            margin: 5px 0;
            border-radius: 5px;
        }

        .success-box {
            background: #d1fae5;
            border-left: 4px solid #10b981;
            padding: 15px;
            margin: 5px 0;
            border-radius: 5px;
        }

        .error-box {
            background: #fee2e2;
            border-left: 4px solid #ef4444;
            padding: 15px;
            margin: 5px 0;
            border-radius: 5px;
        }

        ul, ol {
            margin-left: 20px;
            margin-bottom: 5px;
        }

        li {
            margin-bottom: 8px;
        }

        .badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            margin-left: 8px;
        }

        .next-steps {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 5px;
        }

        .next-steps a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }

        .next-steps a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="nav">
        <div><a href="index.html">‚Üê Back to Documentation Hub</a></div>
        <div>MongoDB Agent AI - API Reference</div>
    </div>

    <div class="container">
        <h1>üìñ API Reference</h1>
        <p>Complete reference for MongoDB Agent AI REST API endpoints.</p>

        <h2>Base URL</h2>
        <pre><code>http://localhost:8001</code></pre>

        <div class="info-box">
            <p><strong>Note:</strong> Default port is 8000. Can be changed via <code>SERVER_PORT</code> in <code>.env</code></p>
        </div>

        <h2 id="endpoints">üì° Endpoints</h2>

        <div class="endpoint">
            <h3><span class="method post">POST</span> <code>/api/mongodb</code></h3>
            <p>Execute a natural language query against MongoDB.</p>

            <h4>Request Body</h4>
            <table>
                <thead>
                    <tr>
                        <th>Field</th>
                        <th>Type</th>
                        <th>Required</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>question</code></td>
                        <td>string</td>
                        <td>‚úÖ Yes</td>
                        <td>Natural language query</td>
                    </tr>
                    <tr>
                        <td><code>yaml_file_name</code></td>
                        <td>string</td>
                        <td>‚úÖ Yes</td>
                        <td>Semantic model YAML file name</td>
                    </tr>
                    <tr>
                        <td><code>include_debug</code></td>
                        <td>boolean</td>
                        <td>‚ùå No</td>
                        <td>Include debug information (default: false)</td>
                    </tr>
                    <tr>
                        <td><code>environment</code></td>
                        <td>string</td>
                        <td>‚ùå No</td>
                        <td>Environment: dev/stage/prod (default: dev)</td>
                    </tr>
                    <tr>
                        <td><code>semantic_model</code></td>
                        <td>object</td>
                        <td>‚ùå No</td>
                        <td>Inline semantic model (alternative to yaml_file_name)</td>
                    </tr>
                </tbody>
            </table>

            <h4>Example Request</h4>
            <pre><code>POST /api/mongodb
Content-Type: application/json

{
  "question": "How many orders were completed last month?",
  "yaml_file_name": "orders_semantic_model.yaml"
}</code></pre>

            <h4>Success Response <span class="badge">200 OK</span></h4>
            <pre><code>{
  "question": "How many orders were completed last month?",
  "yaml_file_name": "orders_semantic_model.yaml",
  "mongodb_query": "db.orders.aggregate([{\"$match\":{\"status\":\"completed\",\"created_date\":{\"$gte\":ISODate(\"2024-11-01\"),\"$lte\":ISODate(\"2024-11-30\")}}},{\"$count\":\"count\"}])",
  "query_result": [
    {"count": 1234}
  ],
  "natural_language_response": "‚Ä¢ A total of 1,234 orders were completed last month.",
  "execution_time_ms": 1234.56,
  "status": "success",
  "timestamp": "2026-02-02T12:00:00",
  "debug_info": null
}</code></pre>

            <h4>Response Fields</h4>
            <table>
                <thead>
                    <tr>
                        <th>Field</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>question</code></td>
                        <td>string</td>
                        <td>Echo of the user's natural language question</td>
                    </tr>
                    <tr>
                        <td><code>yaml_file_name</code></td>
                        <td>string</td>
                        <td>Echo of the semantic model file used</td>
                    </tr>
                    <tr>
                        <td><code>mongodb_query</code></td>
                        <td>string</td>
                        <td>Generated MongoDB aggregation pipeline command</td>
                    </tr>
                    <tr>
                        <td><code>query_result</code></td>
                        <td>array</td>
                        <td>Actual MongoDB query results (structured data)</td>
                    </tr>
                    <tr>
                        <td><code>natural_language_response</code></td>
                        <td>string</td>
                        <td>Human-readable summary of results</td>
                    </tr>
                    <tr>
                        <td><code>execution_time_ms</code></td>
                        <td>number</td>
                        <td>Total execution time in milliseconds</td>
                    </tr>
                    <tr>
                        <td><code>status</code></td>
                        <td>string</td>
                        <td>"success" or "error"</td>
                    </tr>
                    <tr>
                        <td><code>timestamp</code></td>
                        <td>string</td>
                        <td>ISO 8601 timestamp of query execution</td>
                    </tr>
                    <tr>
                        <td><code>debug_info</code></td>
                        <td>object|null</td>
                        <td>Debug information (only when include_debug=true)</td>
                    </tr>
                </tbody>
            </table>

            <h4>Error Response <span class="badge" style="background: #ef4444;">400/500</span></h4>
            <pre><code>{
  "error": "Connection to MongoDB failed",
  "details": "Authentication failed: Invalid credentials",
  "status_code": 500
}</code></pre>

            <h4>cURL Example</h4>
            <pre><code>curl -X POST http://localhost:8001/api/mongodb \
  -H "Content-Type: application/json" \
  -d '{
    "question": "Show me top 10 customers by revenue",
    "yaml_file_name": "orders_semantic_model.yaml"
  }'</code></pre>

            <h4>Python Example</h4>
            <pre><code>import requests

response = requests.post(
    "http://localhost:8001/api/mongodb",
    json={
        "question": "How many orders are pending?",
        "yaml_file_name": "orders_semantic_model.yaml"
    }
)

data = response.json()
print(f"Results: {data['query_result']}")
print(f"Query: {data['query_generated']}")</code></pre>

            <h4>JavaScript Example</h4>
            <pre><code>const response = await fetch('http://localhost:8001/api/mongodb', {
  method: 'POST',
  headers: {'Content-Type': 'application/json'},
  body: JSON.stringify({
    question: 'What is the average order value?',
    collection_name: 'orders'
  })
});

const data = await response.json();
console.log('Results:', data.query_result);</code></pre>
        </div>

        <div class="endpoint">
            <h3><span class="method get">GET</span> <code>/health</code></h3>
            <p>Health check endpoint to verify server status.</p>

            <h4>Example Request</h4>
            <pre><code>GET /health</code></pre>

            <h4>Success Response <span class="badge">200 OK</span></h4>
            <pre><code>{
  "status": "healthy",
  "connection": "direct",
  "database": "your_database_name",
  "version": "1.0.0"
}</code></pre>

            <h4>Response Fields</h4>
            <table>
                <thead>
                    <tr>
                        <th>Field</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>status</code></td>
                        <td>string</td>
                        <td>Server health status: "healthy" or "unhealthy"</td>
                    </tr>
                    <tr>
                        <td><code>connection</code></td>
                        <td>string</td>
                        <td>Connection type: "direct" or "mcp"</td>
                    </tr>
                    <tr>
                        <td><code>database</code></td>
                        <td>string</td>
                        <td>Connected database name (Direct mode only)</td>
                    </tr>
                    <tr>
                        <td><code>version</code></td>
                        <td>string</td>
                        <td>Agent version</td>
                    </tr>
                </tbody>
            </table>

            <h4>cURL Example</h4>
            <pre><code>curl http://localhost:8001/health</code></pre>
        </div>

        <div class="endpoint">
            <h3><span class="method get">GET</span> <code>/</code></h3>
            <p>Root endpoint with basic server information.</p>

            <h4>Example Request</h4>
            <pre><code>GET /</code></pre>

            <h4>Success Response <span class="badge">200 OK</span></h4>
            <pre><code>{
  "service": "MongoDB Agent AI",
  "version": "1.0.0",
  "status": "running"
}</code></pre>
        </div>

        <h2>üìã HTTP Status Codes</h2>

        <table>
            <thead>
                <tr>
                    <th>Code</th>
                    <th>Status</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>200</strong></td>
                    <td>OK</td>
                    <td>Request successful, query executed</td>
                </tr>
                <tr>
                    <td><strong>400</strong></td>
                    <td>Bad Request</td>
                    <td>Invalid request parameters or malformed JSON</td>
                </tr>
                <tr>
                    <td><strong>401</strong></td>
                    <td>Unauthorized</td>
                    <td>Authentication failed (MCP mode)</td>
                </tr>
                <tr>
                    <td><strong>404</strong></td>
                    <td>Not Found</td>
                    <td>Collection or database not found</td>
                </tr>
                <tr>
                    <td><strong>500</strong></td>
                    <td>Internal Server Error</td>
                    <td>MongoDB connection error, query execution error</td>
                </tr>
                <tr>
                    <td><strong>503</strong></td>
                    <td>Service Unavailable</td>
                    <td>LLM provider unavailable or rate limited</td>
                </tr>
            </tbody>
        </table>

        <h2>üîí Authentication</h2>

        <div class="info-box">
            <p><strong>Note:</strong> The API itself does not require authentication. Security is managed at the MongoDB and LLM provider levels.</p>
            <ul>
                <li><strong>MongoDB Auth:</strong> Configured via connection string in <code>.env</code></li>
                <li><strong>LLM Auth:</strong> API keys stored in <code>.env</code></li>
                <li><strong>MCP Auth:</strong> OAuth tokens managed automatically</li>
            </ul>
        </div>

        <div class="warning-box">
            <p><strong>‚ö†Ô∏è Production Deployment:</strong> When deploying to production, implement API authentication (e.g., API keys, OAuth) to protect the endpoint.</p>
        </div>

        <h2>‚ö° Rate Limiting</h2>

        <p>No built-in rate limiting. Rate limits are enforced by:</p>
        <ul>
            <li><strong>LLM Providers:</strong> OpenAI (3,500 requests/min), Anthropic (50 requests/min)</li>
            <li><strong>MongoDB:</strong> Connection pool size (default: 50 connections)</li>
            <li><strong>MCP Server:</strong> External rate limits (varies by deployment)</li>
        </ul>

        <h2>üîÑ Request/Response Examples</h2>

        <h3>Example 1: Count Query</h3>
        <div class="success-box">
            <p><strong>Request:</strong></p>
            <pre><code>{
  "question": "How many users are active?",
  "yaml_file_name": "users_semantic_model.yaml"
}</code></pre>
            <p><strong>Response:</strong></p>
            <pre><code>{
  "question": "How many users are active?",
  "yaml_file_name": "users_semantic_model.yaml",
  "mongodb_query": "db.users.aggregate([{\"$match\":{\"status\":\"active\"}},{\"$count\":\"count\"}])",
  "query_result": [{"count": 15842}],
  "natural_language_response": "‚Ä¢ There are 15,842 active users.",
  "execution_time_ms": 234.56,
  "status": "success",
  "timestamp": "2026-02-02T12:00:00",
  "debug_info": null
}</code></pre>
        </div>

        <h3>Example 2: Aggregation Query</h3>
        <div class="success-box">
            <p><strong>Request:</strong></p>
            <pre><code>{
  "question": "What's the total revenue by product category?",
  "yaml_file_name": "orders_semantic_model.yaml"
}</code></pre>
            <p><strong>Response:</strong></p>
            <pre><code>{
  "question": "What's the total revenue by product category?",
  "yaml_file_name": "orders_semantic_model.yaml",
  "mongodb_query": "db.orders.aggregate([{\"$unwind\":\"$items\"},{\"$group\":{\"_id\":\"$items.category\",\"revenue\":{\"$sum\":{\"$multiply\":[\"$items.price\",\"$items.quantity\"]}}}},{\"$project\":{\"category\":\"$_id\",\"revenue\":1,\"_id\":0}},{\"$sort\":{\"revenue\":-1}}])",
  "query_result": [
    {"category": "Electronics", "revenue": 125000.50},
    {"category": "Clothing", "revenue": 98500.75},
    {"category": "Food", "revenue": 45600.25}
  ],
  "natural_language_response": "‚Ä¢ Electronics: $125,000.50\n‚Ä¢ Clothing: $98,500.75\n‚Ä¢ Food: $45,600.25",
  "execution_time_ms": 1456.78,
  "status": "success",
  "timestamp": "2026-02-02T12:00:00",
  "debug_info": null
}</code></pre>
        </div>

        <h3>Example 3: Error Response</h3>
        <div class="error-box">
            <p><strong>Request:</strong></p>
            <pre><code>{
  "question": "Show me data",
  "yaml_file_name": "nonexistent_collection.yaml"
}</code></pre>
            <p><strong>Response (404):</strong></p>
            <pre><code>{
  "error": "Collection not found",
  "details": "Collection 'nonexistent_collection' does not exist in database",
  "status_code": 404
}</code></pre>
        </div>

        <h2>üß™ Testing the API</h2>

        <h3>Using Postman</h3>
        <ol>
            <li>Create new POST request to <code>http://localhost:8001/api/mongodb</code></li>
            <li>Set header: <code>Content-Type: application/json</code></li>
            <li>Add request body:
                <pre><code>{
  "question": "Your question here",
  "yaml_file_name": "your_semantic_model.yaml"
}</code></pre>
            </li>
            <li>Send request and view response</li>
        </ol>

        <h3>Using HTTPie</h3>
        <pre><code>http POST localhost:8001/api/mongodb \
  question="How many orders?" \
  collection_name="orders"</code></pre>

        <h3>Using Python Requests</h3>
        <pre><code>import requests

response = requests.post(
    "http://localhost:8001/api/mongodb",
    json={
        "question": "Show me pending tasks",
        "yaml_file_name": "tasks_semantic_model.yaml"
    }
)

print(response.status_code)
print(response.json())</code></pre>

        <h2>üìä Response Time Breakdown</h2>

        <p>Typical response time: <strong>1-4 seconds</strong></p>

        <table>
            <thead>
                <tr>
                    <th>Component</th>
                    <th>Time</th>
                    <th>Percentage</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>LLM Query Generation</td>
                    <td>1-3 seconds</td>
                    <td>70-80%</td>
                </tr>
                <tr>
                    <td>MongoDB Query Execution</td>
                    <td>10-100ms</td>
                    <td>5-10%</td>
                </tr>
                <tr>
                    <td>Result Formatting</td>
                    <td>10-50ms</td>
                    <td>2-5%</td>
                </tr>
                <tr>
                    <td>Network Overhead (MCP)</td>
                    <td>100-200ms</td>
                    <td>5-10% (MCP only)</td>
                </tr>
            </tbody>
        </table>

        <div class="next-steps">
            <h3>üìö Related Documentation</h3>
            <ul>
                <li><a href="usage.html">üí° Usage Examples</a> - See real-world examples</li>
                <li><a href="architecture.html">üèóÔ∏è Architecture</a> - Understand the internals</li>
                <li><a href="troubleshooting.html">üîß Troubleshooting</a> - Fix common issues</li>
            </ul>
        </div>
    </div>
</body>
</html>
